# 计算机视觉

## 相机

小孔成像相机

没有小孔的画，物平面可以完全映射到相平面上每一个点



两倍小孔直径会增加四倍的光

两倍焦距会减少四分之一的光
$$
\frac{1}{D'}+\frac{1}{D}=\frac 1 f
$$
<img src="pics/image-20230608165943552.png" alt="image-20230608165943552" style="zoom:50%;" />



FOV（Field of View）取决于焦距(f)和传感器长度(d)
$$
\varphi = tan^{-1}(\frac d {2f})
$$


两倍

滤波：

高斯平滑滤波



边缘检测：

高斯微分

拉普拉斯微分



## 图像滤波器

方框滤波：卷积核中所有值相等，可以选择为均值，也可以选择为相加



卷积和互相关



### 高斯滤波器(The Gaussian filter)：

2D高斯卷积核
$$
f(i,j)=\frac 1 {2\pi\sigma^2}e^{-\frac{i^2+j^2}{2\sigma^2}}
$$
权重理论上随着距离无限增加，但一般在$$2-3\sigma$$处截断

- 可以去除高频的部分——低通滤波器
- 和自己卷积是另一个高斯
- 可以分离

离散滤波器使用有限核，$$\sigma$$越大，下降越平缓

**最好使得核边缘接近于0，将滤波器的半宽设置为$$ 3\sigma $$**



### 差分高斯滤波器(DoG)

​		在成像科学中，高斯差分(DoG)是一种特征增强算法，它涉及将原始图像的一个高斯模糊版本从另一个模糊程度较低的原始图像中减去。在灰度图像的简单情况下，通过将原始灰度图像与具有不同宽度(标准差)的高斯核进行卷积得到模糊图像。使用高斯核模糊图像只抑制高频空间信息。从另一幅图像中减去一幅图像保留了位于两个模糊图像中保留的频率范围之间的空间信息。因此，DoG是一个空间带通滤波器，它对原始灰度图像中远离带中心的频率进行衰减。



### 降噪和非线性图像滤波

椒盐噪声:包含随机出现的黑色和白色像素

脉冲噪声:包含随机出现的白色像素

高斯噪声:由高斯正态分布得出的强度变化



减少高斯噪声：使用一个较大标准差的平滑，但也模糊了图像

椒盐噪声：中值滤波



### 其他过滤器

加权中值(离中心更远的像素计数更少)

裁剪平均值(忽略少数最亮和最暗像素的平均值)

双边过滤(通过空间距离和强度差加权)



### 双边滤波(Bilateral Filters)

对与空域和值域同时进行滤波

空域滤波采用的是高斯滤波

<img src="pics/image-20230609190615661.png" alt="image-20230609190615661" style="zoom:50%;" />



联合双边滤波：

如果在值域的权重计算过程引入另外一幅图像，如下式，则称之为联合双边滤波。 ~I 就是引入的另外一幅图像。该图像 **必须**与待处理的图像相似。



## 边缘检测

目标：从二维图像中获取曲线或直线边缘

思路：后期处理后寻找强烈渐变

边缘是图像函数强度中变化最快的部分



### Sobel算子

<img src="pics/image-20230609195715352.png" alt="image-20230609195715352" style="zoom:67%;" />

与图像卷积求导：

$$\frac{\delta f}{\delta x}S_x \otimes f$$    	$$\frac{\delta f}{\delta y}S_y \otimes f$$

计算梯度：

<img src="pics/image-20230609202828522.png" alt="image-20230609202828522" style="zoom:67%;" />



对噪声敏感：

<img src="pics/image-20230609203248100.png" alt="image-20230609203248100" style="zoom:67%;" />





### 构建边缘检测器

**二值化**

**非极大值抑制**（Non-Maximum Suppression）

​	只选择阈值以上的边缘

**阈值筛选**

​	使用一个高阈值开始线段，然后以一个低阈值继续



### Canny边缘检测

1. 平滑图像，降噪
2. 计算x和y方向上的梯度
3. 求梯度的大小和方向
4. 非最大值抑制
5. **阈值筛选**：定义两个阈值:低和高使用高阈值开始边缘曲线，使用低阈值继续边缘曲线



## 图像特征

### 角点检测(Corner Detection)

从小窗中识别

#### 如何发现角点

- 角点是可重复和独特的
- 在角点旁的区域，图像梯度有两个或者多个方向



### Harris角点检测

<img src="pics/image-20230610100229866.png" alt="image-20230610100229866" style="zoom: 50%;" />

**点在任意一个方向上做微小移动，都会引起该区域的梯度图的方向和幅值发生很大变化。**

1. 先求窗口的变化量：

   窗口在各个方向上移动$$(u,v)$$所造成的像素灰度值的变化量公式如下
   $$
   E(u,v) = \sum_{(x,y)}w(x,y)\times[I(x+u,y+v)-I(x,y)]^2
   $$
   对于上述公式在实际中计算较慢，我们采用泰勒展开，当u，v很小时
   $$
   I(u+x,v+y)=I(x,y)+uI_x+vI_y
   $$
   推导后
   $$
   E(u,v)=[u,v]M \left[ \begin{align} u\\v  \end{align} \right]\\
   M=\sum_{(x,y)}w(x,y) \left[\begin{matrix} I_x^2 && I_xI_y \\ I_xI_y && I_y^2   \end{matrix} \right] \rightarrow R^{-1}  \left[ \begin{matrix} \lambda _1 &&0\\
   0 && \lambda_2 \end{matrix} \right]R
   $$

2. 计算角点得分

   灰度值的变化取决于M矩阵

   计算每个窗口对应的得分（角点响应函数R）：
   $$
   R=det(M)-k(trace(M))^2
   $$
   其中$$det(M)=\lambda_1\lambda_2$$是矩阵的行列式，$$trace(M)=\lambda_1+\lambda_2$$是矩阵的迹

3. 判断

   可以先使用**非极大值抑制**

   平面: 该窗口在平坦区域上滑动，窗口内的灰度值基本不会发生变化，所以$$|R|$$值非常小，在水平和竖直方向的变化量均较小，即$$I_x和I_y$$ 都较小，那么 λ1 和 λ2 都较小；

   边缘:R值为负数，仅在水平或竖直方向有较大的变化量，即$$I_x和I_y$$只有一个较大，也就是 λ1>>λ2 或 λ2>>λ1；

   角点：R值很大，在水平、竖直两个方向上变化均较大的点，也就是 λ1 和 λ2 都很大

角点检测对应平移有不变性，对于旋转有协变性，对于尺寸变化没有协变性



## 单目几何

### 齐次坐标

欧氏空间（几何学）中平行线不可能相交，但是投影几何中，无穷直线会在无穷远点相交

所以欧式空间的描述方式难以描述投影几何

解决方案：齐次方程

要制作二维齐次坐标，我们只需在现有坐标中增加一个额外的变量w。因此，笛卡尔坐标中的一点，(X，Y)在齐次坐标中就变成了(x，y，w)。而笛卡儿坐标中的X和Y在齐次坐标中的x、y和w则重新表达为
$$
X=x/w \\
Y=y/w
$$

#### 为什么叫齐次

任何乘以a的数（1a，2a，3a）与欧氏空间中的（1/3，2/3）是同一个点

换句话说，齐次坐标是与乘数a不相关的。

#### 两条线可以相交

当我们重写投影空间的方程，当w=0时，方程有解，则可以相交



### 二维仿射变换

仿射变换内容：
$$
X'=S_xX\\Y'=S_yY
\\
\left [
\begin  {matrix}
X'\\
Y'
\end{matrix}
\right ] =

\left [ \begin{matrix}
S_x&&  0 \\
0&  & S_y \end{matrix} \right]

\left[ \begin{matrix}X\\Y \end{matrix}\right]
$$


## 卷积神经网络

