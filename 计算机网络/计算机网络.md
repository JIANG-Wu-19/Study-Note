# 计算机网络

- 重点
  - 软硬件组成
  - 参考模型
- 难点
  - 网络体系结构
  - 网络协议概念
  - 网络分层思想

### 网络的软硬件组成

**硬件：**计算设备

通信链路

路由器

**软件：**协议，应用程序

## 网络体系结构

### *协议

协议：指通信双方关于如何进行通信的一种约定

网络协议：同等实体间通信制定的有关通信规则的约定

**对等实体（peer）**,不同机器包含的对应层的实体，如进程，硬件

对等体可能是进程、硬件设备、或人

- 协议实现的细节和接口的规范是由具体的实现者决定的，不影响网络体系结构的定义。
- 一个网络中所有机器上的接口不必都一样，只要每台机器能够正确地使用所有的协议即可
- 不同的网络，其层的数目、各层的名字、内容和功能都不尽相同，但是**每一层的目的都是向它的上一层提供服务**，而把如何实现这一服务的细节对上一层加以屏蔽。
- 网络协议是控制两个或多个网络设备之间通信的规则的集合。网络协议可以分为不同的层次，每一层负责实现不同的功能，并向上一层提供服务。在同一层次上，不同设备之间的通信需要遵循相同的协议，以保证信息的正确传输和解释。例如，应用层协议包括了 HTTP、FTP、SMTP 等，它们规定了应用程序之间如何交换数据；传输层协议包括了 TCP、UDP 等，它们规定了如何建立和维护端到端的连接；网络层协议包括了 IP、ICMP、ARP 等，它们规定了如何寻址和路由数据包；数据链路层协议包括了 Ethernet、PPP、HDLC 等，它们规定了如何在物理介质上传输比特流等等

### 服务

    服务是各层向它上层提供的一组原语。**服务定义了两层之间的接口**，上层是服务用户，下层是服务提供者。
    
    只要不改变提供给用户的服务，实体可以任意地改变它们的协议。 n层实体利用n－1层实体提供的服务并执行n层协议来完成对n＋1层提供服务。
    
    数据报服务是一种不可靠的无连接服务

### 面向连接服务和无连接服务

（1）面向连接服务
	面向连接服务是在**数据传输之前必须先建立连接，在数据传输结束后再释放这个连接。**
	具有连接建立、数据传输和连接释放三个阶段。在传输数据时是按序传输的，这与电路交换的许多特性很相似，因此，面向连接服务在网络层中又称为虚电路服务。这里的“虚电路“表示：虽然在两个服务用户的通信过程中并没有始终占用一条端到端的完整物理电路，但用户在感觉上却好像一直在使用这样的一条电路，实质上它是通过分时共享物理电路的技术来实现的。面向连接服务比较适合在一定期间内要向同一目的地发送多个数据的情形。对于偶尔发送很少量的数据，面向连接服务则由于开销过大而不太适应。
	若两个用户需要进行频繁的通信，则可建立永久连接。这样可以免除在每次通信时进行连接建立和连接释放这两个过程，永久连接与电话网中的专用话音电路十分相似。
（2）无连接服务
	在无连接服务的情况下，两个实体之间的通信无须预先建立一个连接，因此，有关资源不需要事先进行预定保留，这些资源在数据传输时动态分配。日常通信中的短信业务提供的就是无连接服务。
	无连接服务的另一个特征就是它不需要通信的两个实体同时处于活跃状态。当发送端的实体正在进行数据传输时，它必须是活跃的，但此时接收端的实体并不一定必须是活跃的。只有当接收端的实体正在进行数据接收时，它才必须是活跃的。
	无连接服务的优点在于灵活方便和迅速及时，但它不能防止数据的丢失、重复或乱序。无连接服务特别适合传输少量数据的情形。
	无论是面向连接服务还是无连接服务，都不能保障数据传输的可靠性。在此，我们使用服务质量（Quality of Service，QoS）来评价服务的特性，有些服务十分可靠，从来不丢失数据。为了实现可靠的服务，通常是由接收端确认接收到每一个数据，使发送端确信它所发送的数据已经正确到达接收端这一方法来实现的。这种确认机制要增加额外的传输开销和延迟，对于不同的网络应用，有时是值得的，但有时则不尽然。
	有两种面向连接的可靠性服务应用比较广泛，即消息流和字节流。消息流保持应用消息的边界，如发送端发送两个1KB的消息，接收端肯定也是接收到两个1KB的消息，绝不会变成一个2KB的消息。而字节流则没有消息边界，如2KB字节到达接收端后，接收端根本无法分辨所接收的数据究竟是一个2KB的消息还是两个1KB的消息，或者是2048个单字节消息。如果在网络上传送一本书，当把每页作为分离的消息进行传输时，保留消息的边界就变得比较重要。然而，作为一个终端在远程分时系统上登录时，从终端到计算机的字节流传输就能够满足需求。
	对于某些网络应用而言，面向连接的数据传输因确认引起的延迟可能难以满足用户的需求。比如数字化的音频传输，网络用户宁可听到线路上偶尔出现的杂音，或不时混淆的声音，也不愿意因等待确认而造成延迟。同样，在传输视频数据时，错了几个像素并无大碍，但视频突然停顿以等待纠正传输错误却会令人十分不满意。

### *五层协议体系

<img src="pics/image-20230308154717452.png" alt="image-20230308154717452" style="zoom:50%;" />

### OSI模型

七层模型

<img src="pics/image-20230308152018007.png" alt="image-20230308152018007" style="zoom:50%;" />

### 性能指标

速率 带宽 往返时间RTT 利用率

**吞吐量：**单位时间通过网络的数据量，受到网络带宽或者速率限制

**时延：**数据从一段到另一端所需要的时间

1. 发送时延（传输时延）：

$$
发送时延=\frac{数据帧长度(bit)}{发送速率(bit/s)}
$$

2. 传播时延：可以按照光速的2/3算，短距离可以忽略不记

$$
传播时延=\frac{信道长度}{信号在信道上的传播速率(米/秒)}
$$

3. 处理时延
   - 主机或路由器收到分组后，为处理分组的时间
4. 排队时延
   - 排队等待的时长
   - 排队时延的长短往往取决于网络中当时的通信量

**时延带宽积：**以byte为单位的链路长度

$$
时延带宽积=传播时延 *带宽
$$

## 物理层

### 三个通讯方式

|    名称    |                   定义                   | 需要的信道数 |
| :--------: | :--------------------------------------: | :----------: |
|  单工通信  |             只能一个发一个收             |     一条     |
| 半双工通信 | 都可以发或者收，但是同一时间只能进行一个 |     两条     |
| 全双工通信 |            都可以同时收发数据            |     两条     |

### 码元（[Symbol]）

定义：码元是指用一个固定时长的信号波形（数字脉冲），代表离散数值的基本波形。当有多个离散状态时，成为M进制码元
一个码元可以携带多个比特的信息
个人理解：码元就是在网线上传输的一个个信号段。码元的不同进制就是用来表示不同的数值的



### 波特（Baud）

用来指一秒可以传输多少个码元



### *两个定理

#### 奈奎斯特定理（采样定理）：

当采样频率大于信号中最高频率的2倍时(fs>2f)，采样之后的数字信号完整地保留了原始信号中的信息。

$$
理想低通信道下的极限数据传输率=2Wlog_2V(b/s)
$$


1. 码元传输速率是有上限的
2. 信道的频带越宽，就可以以更高的速率进行码元传输
3. V表示信号的离散级数，即系统可调制出的信号状态

#### 香农定理：

在带宽受限且有噪声的信道中，为了不产生误差，对于信息传输速率的极限值

**信噪比(dB)=**
$$
信道极限传输速率=Wlog_2(1+S/N)(b/s)
$$

注意这里的单位是dB，但S/N本身不是以dB为单位

### 复用：

**同步时分多路复用**：分配给每个终端的时间片固定

**统计时分多路复用**：

**码分多路复用：**


### 公共交换电话网络：
### 数据交换方式

#### ①分组交换

**分组交换采用把一个个小的数据包存储转发传输来实现数据交换。**

主要的一些**缺点**：
1、不具有实时性。
2、存在延时。
3、会造成通信阻塞。
4、存在无用的重复数据。
5、会出现丢包的情况。

**优点**：

1、设计简单。

2、资源利用率很高。



#### ②电路交换

电路连接的**三个阶段**：

1、建立电路连接。
2、数据传输。
3、释放连接（电路拆除）。

**优点**：
1、传输速度快、高效。
2、实时，不会有冲突

**缺点**：
1、资源利用率低。
2、新建连接需要占据一定的时间，甚至比通话的时间还长。



#### ③报文交换（包交换）

不建立物理电路，将发生数据作为整体交给中间交换设备，中间交换设备选择一条合适的空闲输出线将数据发给下一个中间交换设备，直到达到目的地



**电路交换的多路复用**
频分多路复用FDM
时分多路复用TDM

<img src="https://img-blog.csdnimg.cn/20210622190134338.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTAxODY5,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" style="zoom:50%;" />

### 信道复用

> 复用 (multiplexing) 是通信技术中的基本概念。
> 它允许用户使用一个共享信道进行通信，降低成本，提高利用率。

#### ①频分复用

- 将整个带宽分为多份，用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。
- 频分复用的所有用户在同样的时间占用不同的带宽资源（请注意，这里的“带宽”是频率带宽而不是数据的发送速率）。

在这里插入图片描述

#### ②时分复用

时分复用则是将时间划分为一段段等长的时分复用帧（TDM 帧）。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。

<img src="pics/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTAxODY5,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述" style="zoom: 50%;"  />

同步时分复用技术：每个终端分配的时间片固定，不能被抢夺

统计：动态分配，充分利用信道，控制比较复杂

#### ③波分复用

波分复用就是光的频分复用。使用一根光纤来同时传输多个光载波信号。

<img src="pics/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MTAxODY5,size_16,color_FFFFFF,t_70-16791122282616.png" alt="在这里插入图片描述" style="zoom:50%;" />



#### ④码分复用

各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰。运行所有站点同时使用整个信道发送

每个用户分到唯一的M比特码序列

### 传输介质

#### 双绞线

由两根采用**一定规则并排绞合**的、互相绝缘的**铜导线**组成

- 便宜
- 通信距离一般为几公里到几十公里
- 距离太远，需要中继器和放大器处理

#### 同轴电缆

同轴电缆比双绞线有更好的屏蔽性，因此能以更高的速率传输更长的距离，其可能达到的带宽取决于电缆的质量、长度、数据信号的信噪比等，并广泛应用于有线电视网和城域网中；

<img src="pics/image-20230315092549904.png" alt="image-20230315092549904" style="zoom:50%;" />

#### 光纤

光纤由纤芯（实心）和包层组成，带宽很大

把电脉冲转换为光源

<img src="pics/image-20230315092926994.png" alt="image-20230315092926994" style="zoom:50%;" />

单模光纤的直径大概为8-10um



特点：

1. 损耗小
2. 抗磁性强
3. 不易被窃听
4. 体积小，重量轻



光纤融合：

（1）可以将它们接入连接头并插入光纤插座，连接头要损失10%到20%的光，但重新配置系统容易；

（2）可以用机械方法将其结合，但要损失大约10%的光；

（3）两根光纤可以被融合在一起形成坚实的连接，但有点衰减；

### 物理设备

#### 中继器

对信号进行**再生**和**还原**，再生数字信号



## 数据链路层

数据链路(data link) 除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。
现在最常用的方法是使用适配器（即网卡）来实现这些协议的硬件和软件。

目的：实现两个节点的无差错传输

### 功能：

1. 封装成帧
2. 透明传输
3. 差错控制 

### 提供的服务

**基本服务**:将源机器的网络层数据传输到目的地机器网络层。

1. 无确认 无连接服务
   - 接收方不对收到的帧进行确认
   - 由于线路上的噪声而造成的帧丢失，数据链路层不作努力去恢复，而将该工作留给上层
   - 局域网 以太网
2. 有确认 无连接服务
   - 每一帧都单独确认
   - WIFI
3. 有确认有连接服务
   - 网络层进程提供了可靠的位流.适用于长距离且不可靠的链路
   - 卫星通路

### 成帧

<img src="pics/image-20230322171328585.png" alt="image-20230322171328585" style="zoom:67%;" />

成帧(Framing)：在发送方，数据链路层从网络层获得分组（Packet)后，要加上必要的帧头与帧尾后传送给物理层，并通过物理层传送到接收方的数据链路层。
拆帧：在接收方，数据链路层则必须去掉发送端数据链路层所加的帧头和帧尾部分，从中分离出网络层所需的分组。

#### 方法

常用方法：

1. 字节计数法：在数据前一个数字表示有几位，害怕标记位错误
2. 带字节填充的标志字节法：Flag+Header组成，害怕数据位中有flag
3. 带位填充的标志比特法：每一帧使用一个特殊的位模式“01111110”作为开始和结束标记，数据中每遇到5个1则插入一个0
4. 物理层编码违例法



透明：

“在数据链路层透明传送数据”表示无论发送什么样的比特组合的数据，这些数据都能够按照原样没有差错地通过这个数据链路层。



### 差错控制

误码率：
   	
$$
P_e=错误接收的码元数/接收的码元总数
$$
**不管信道质量多高，无论通过哪种类型传输介质或信道进行数据传输，误码率都不可能是零**



#### 检错码

1. 奇偶校验码
   1. 水平奇偶校验
   2. 垂直奇偶校验
   3. 垂直水平奇偶校验
2. 校验和（Check Sum）
3. 块校验码（Block Check Code）
4. 循环冗余校验码（CRC）



要做到“可靠传输”（即发送什么就收到什么）就必须再加上**确认和重传**机制。  



### 流量控制

流量控制的作用是使发送方所发出的数据流量，使其**发送速率不要超过接收方所能接收的速率**

滑动窗口：

实际的通信往往是全双工通信
**捎带应答（piggybacking）**：将确认序号携带在数据帧中传输，提高线路的效率；
推迟确认：当需要发送确认但没有要发送的数据进行捎带时，可以让确认信息推迟一小段时间再发送；
滑动窗口协议：允许发送端在没有收到前一个帧的确认时，就可以发送后续的帧；接收端可以对正确收到的若干个帧同时进行确认。
**滑动窗口协议的要点：**
任何时刻发送进程维持一组帧序号，对应于一组已经发送但尚未被确认的帧，用一个发送窗口维持这些帧；
接收进程也维持一组帧序号，对应于一组允许接收的帧，用一个接收窗口维持这些帧序号。



### 协议

无限制的单工信道（非常理想的条件）：一个发送，一个接收

单工停-等协议（只是进行流量控制）：一次发送一帧，保证能接收

有噪信道上的单工协议：

- 采用协议2中的停-等方式；
- 发送方每次只发送一个帧，当这个帧被正确接收后才能发送下一帧，若该帧未在规定的时间内得到确认（超时），则重发该帧；
- 接收端对每个收到的帧进行校验，对正确收到的帧发回确认，错误的帧丢弃；



#### 滑动窗口协议

协议四：滑动窗口大小都是一

