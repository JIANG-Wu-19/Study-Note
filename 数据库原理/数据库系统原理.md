# 数据库系统原理

## 引言

#### 数据管理的阶段

- 人工管理
  - 纸质或者说物理方式
  - 容易丢数据
  - 数据重复
- 计算机出现以后，通过文件系统方式存储数据
  - 如今仍然使用文件方式保存
  - 不能实现记录和数据项的访问和共享，数据冗余大，利用率低
  - 逻辑文件和物理文件间的独立性差，物理文件结构的改变影响程序的运行。
  - 应用程序设计困难，程序员要进行程序设计实现对数据的操作，（查找、插入、删除、修改）对程序员的算法和程序设计的能力要求高。
  - 易造成数据的不一致性。 



#### 数据库系统的组成

- 数据库
  - 逻辑上来看，它是数据的集合
  - 它把我们关心的数据的集合按一定结构组织在一起
  - 在计算机的物理上看来它就是一些数据集的文件
- 数据库管理系统（核心）
  - 专门描述、管理和维护数据库的系统
- 数据库应用程序
  - 允许用户开发数据库的工具
  - 能让用户方便的获取、更新和利用数据库管理系统中管理和维护的数据库中的数据。
  - 是数据库系统的核心组成部分,它连接着数据库应用程序和数据库
  - 建立在操作系统的基础上，对数据库进行统一管理和控制



<img src="pics/image-20230628123114053.png" alt="image-20230628123114053" style="zoom:50%;" />




### 体系结构

#### 三级结构两级独立性

三个抽象极：用户级，概念级，物理级

<img src="pics/image-20230530141853200.png" alt="image-20230530141853200" style="zoom:67%;" />

物理级对应**内模式：**描述数据的实际存贮组织，内部记录组成，又称为内部视图，物理级数据库并不是真正的物理存贮，而是是最接近于物理存贮的级

概念极对应**概念模式：**介于用户级和物理级之间，是所有用户视图的最小并集，数据库管理员看到的

用户级对应**外模式：**用户看到和使用的数据库，又称为用户视图，不同用户视图可以互相重叠，用户的所有操作都是针对用户视图进行



用户级和概念级：

- 一个数据库可有多个不同的用户视图，每个用户视图由数据库某一部分的抽象表示所组成。

- 一个数据库应用系统只存在一个DBA视图，它把数据库作为一个整体的抽象表示。概念级模式把用户视图有机地结合成一个整体，综合平衡考虑所有用户要求。

- 实现数据的一致性、最大限度降低数据冗余、准确地反映数据间的联系。



数据库系统两级独立性：逻辑独立性、物理独立性

- 三个抽象级间通过两级映射（根据一定的对应规则）进行相互转换，
- 使得数据库的三级形成一个统一整体。
- 映射隔离了各层之间的相互影响，实现数据独立性。
- 各层间的映射能力决定数据独立性程度。



物理独立性：隔离变化，底层数据的变化对于数据的使用者来说是不透明的

逻辑独立性：模式和外模式之间，是他们的映射转换实现逻辑独立性





#### 数据模型

- 关系模型
- 实体-联系模型
- 基于对象的数据模型



### 数据的存储和查询





## 设计理论1——关系模型与完整性
<img src="pics/image-20230630010249796.png" alt="image-20230630010249796" style="zoom: 67%;" />



### 数据描述

- 现实世界
  - 存在于人们头脑之外的客观世界，称为现实世界
  - 现实世界中的数据是原始数据，是数据库设计者的原材料
- 信息世界
  - 信息世界是现实世界在人们头脑中的反映，并用文字和符号记载下来
- 机器世界（或计算机世界）
  - 信息世界的信息在机器世界中以数据形式存储



#### 信息世界的数据描述术语

实体

- 客观存在东西称为实体。实体可以是具体的对象，也可以是抽象的事件，例如：一名男学生，一辆汽车等；一次足球比赛，一次借书等。

实体集

- 性质相同的同类实体的集合，称为实体集。例如所有的男学生，全足球锦标赛的所有比赛等。

属性

- 实体有很多特性，每一个特性称为属性。每个属性有一个值域，其类型可以是整数型、实数型或字符串型。例如学生有学号、姓名、年龄等属性，相应值域为字符串、字符串、整数。

实体键

- 能唯一标识每个实体的属性或属性集，称为实体的键。例如学生的学号可以作为学生实体的键。

#### 机器世界的数据描述术语

字段

- 标记实体属性的命名单位称为字段或数据项。它是可以命名的最小信息单位，所以又叫数据元素或初等项。字段的命名往往和属性名相同。例如学生有学号、姓名、年龄、性别等字段。

记录

- 字段有序集合称为记录。一般用一个记录描述一个实体，所以记录又可以定义为能完整地描述一个实体的字段集。例如一个学生记录（990001，王军，20，男，计算机）由有序的字段集组成。

文件

- 同一类记录的汇集称为文件。文件是描述实体集的，所以它又有可以定义为描述一个实体集的所有记录集。例如所有的学生记录组成了一个学生文件。

记录键

- 能唯一标识文件中每个记录的字段或字段集，称为文件的键（或记录的键）。这个概念与实体集的键概念相对应。例如学生的学号可以作为学生记录



### 实体－联系模型 ER模型

实体 属性 联系

联系有1-1，1-n，n-n

实体一般是长方形来体现，而属性则是椭圆形，关系则用菱形表示，关系也可能有属性

每个实体有一个键，唯一的确认实体



在建立 E-R图的时候，应根据实际应用首先确定哪些是实体集，有多少个实体集，其次确定实体集的属性，然后再确定这些实体集之间存在什么联系及联系的属性。



属性的更详细的画法

- E-R图中: 带下划线的属性为实体键或实体键的一部分。 组合属性用一个树型表示。多值属性用虚线椭圆表示或标出。
- 关系型数据库系统不能处理组合属性和多值属性的情况，实际操作时要转化成原子属性和单值属性的情况。



DBMS主要有：

1. 层次数据库系统
2. 网状数据库系统
3. 关系数据库系统



### 关系数据库

#### 介绍

IBM提出

理论基础：关系代数

数据结构：二维表

定义：

实体和联系均用二维表来表示的数据模型称为关系数据模型



#### 关系模式

二维表表头哪一行，称为关系模式，关系模式名互不相同



**关系->表**

**元组->行**

**属性->列**

**变域->属性的值域**

**关键字->key**

**候选关键字：**
一个关系中，存在多个属性或属性组合都能唯一表示该元组，则称为候选关键字

**主关键字：**

候选关键字中的一个

**外部关键字：**

> 外键是关系模型中的一种约束，它用于建立和加强两个表数据之间的链接。一个表中的一个字段引用了另一个表中的主键，引用的表叫做从表，被引用的表叫做主表



### 关系数据模型完整性约束规则（必考）

- 完整性约束是关系数据库模型的重要组成部分 
  - 数据库管理系统通过对单个属性的取值范围、主关键字的属性以及属性之间的关系加以制约（约束），以及提供对违反约束的处理过程实现保证数据库的数据与现实世界的一致性。 

- 域完整性 
  - 属性取值必须取自于值域
  - 属性是否能取空值由其语义决定。域完整性是最基本的约束 

- 实体完整性
  - 主关键字值必须是唯一的且任何组成成份都不能是空值。 

- 引用／参考完整性 
  - 一用来保证表之间的关系的完整 

- 用户自定义完整性
  - 创建业务规则来确保值的有效性，从而使之落在需要范围之内



关系数据模型的操作必须满足关系的完整性约束条件。





### 将实体联系模型转化为关系数据模型 

**规则1** 

- **每个实体类型转化为一个关系模式**，实体的属性转化为该为关系模式的属性：实体标识符（实体健）转化为该关系模式的键，每一个实体转化为该关系模式对应关系的一个元组。 

**规则2** 

- 实体类型间的每一个自身有属性的联系转化为一个关系模式，该联系的属性直接转化为该关系模式的属性，与该联系所关联的所有实体类型的实体键都转化为该关系模式的属性，共同组成该关系模式的主关键字。 

**规则3** 

- 若联系自身无属性

- 对1:N型联系，则1侧实体类型的实体健转化为属性加入到N侧实体类型 

- 对M:N型联系，则两侧实体类型的实体键都转化为属性，互相加入到对侧实体类型所转化后的关系模式中，和该关系模式的原主关键字一起，共同构成该关系模式新的主关键字；或者建立一个新关系模式关键字是关系的双方的主键共同组成（推荐后面这种）

- 对1:1型联系，则按1:N或M:N处理。



**简单说：**有属性的实体类型或者联系变成表，没有属性的联系将1的属性放到N中



### 范式：



### 判断候选码

1. 没在函数依赖集中，一定在候选中
2. 只在右边，一定不是候选
3. 只在左边，一定是候选
4. 能唯一的标识元组



## 视图

视图是一个不存在的表，其内容是由查询定义的

1. 集中用户的数据
2. 简化用户管理安全性
3. 隔离变化



## 考试

十个选择

四个简答

规范化题  主键 函数依赖关系 关键字

设计题  ER图

编程 SQL编程





