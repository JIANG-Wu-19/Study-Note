# 计算机体系结构——量化研究方法

## 基础

### 计算机体系结构的定义

#### 指令集体系结构

1. **ISA分类**

   现今几乎所有的 ISA 都划分到通用寄存器体系结构中，在这种体系结构中， 操作数或者是寄存器，或者是存储器地址。有两种主流版本，一种是**寄存器-存储器 ISA** ，比如 80x86 ，可以在许多指令中访问存储器;另一种 是**载入-存储 ISA** ，比如 ARM MIPS ，它们只能用载入或存储指令来访问存储器。所有最新 ISA 都采用载入-存储版本。
2. **存储器寻址**

   使用**字节寻址**来访问存储器操作数，如果操作数是对齐的，通常访问会更快
3. **寻址模式**

   MIPS 寻址模式为:寄存器(寻址)、立即数(寻址)和位移量(寻址)。

   立即数寻址用于常数寻址，

   在位移量寻址模式中，将一个固定偏移量加到寄存器，得出存储器地址。

### 设计满足目标和功能需求的组成和硬件

体系结构涵盖了计算机设计的所有三个方面 指令集体系结构、组成或微体系 结构、硬件。

计算机架构师设计的计算机必须满足功能需求，并达到价格、功耗、性能和可用性指标。

### 集成电路中的功率和能耗趋势

架构师通常需要考虑：

1. 处理器最大功耗是多少
2. 持续功耗是多少，通常被称为**热设计功耗**(TDP)，TDP 既不是峰值功率(峰值功率通常要高1.5倍)，也不是在一个给定计算期间消耗的实际平均功率(它可能还要更低一些)

衡量哪个处理器执行某个任务更为高效，应该使用的是能耗：

能耗 = 平均功率 $\times$ 执行时间

#### 微处理器内部的能耗和功率

传统能耗主要是开关晶体管，对于一项固定任务，降低时钟频率可以降低功率，而不会降低能耗。

显然，通过降低电压可以大幅降低动态功率和能耗，但当我们从一种制造工艺转向另一种工艺时，晶体管的开关次数以及其开关频率的增高强于负载电容和电压的下降，从而导致功耗和能耗的总体上升。

现代处理器提供了一些方法来提高能耗效率：

1. 微处理器会关闭非活动模块的时钟
2. 动态电压-频率调整
3. 针对典型情景的设计
4. 超频，短时间的超频

尽管通常认为**动态功率**是 CMOS 中的主要功率耗散源，但由于即使品体管处于截止状态时也存在泄漏电流，所以**静态功率**也正在成为一个重要问题

### 可信任度

    如何判断一个系统的运行是否正常，这是一个难题。随着互联网服务的普及，这一问题变得更为明确。基础设施供应商开始提供**服务等级协议 (SLA) 或服务等级目标 (SLO)**，保证他们的网络或电源服务是可靠的。

    系统在SLA规定的两种服务中切换：

1. 服务实现
2. 服务中断，即提供服务不一致

### 性能的测量、报告和汇总

性能测试的指标：完成任务的时间

对比计算机性能并非总是使用这一指标。唯一稳定、可靠的性能度量就是实际程序的执行时间，以任意其他度量代替时间或者以任意其他被测项目代替实际程序，最终都会在计算机设计中产生误导，甚至是错误。

最直接的时间定义被称为**挂钟时间，晌应时间或已用时间**，也就是完成一项任务的延迟，包括磁盘访问、存储器访 问、输入/输出活动、操作系统开销等所有相关时间。

各种基准测试软件是测试电脑性能的主要方法；在报告性能测试结果时，应当坚持一条指导原则一一可重现性，即列出其他试验者在重现该结果时所需要的全部信息。

**局域性原理**:程序常常重复使用它们最近用过的数据和指令。一条广泛适用的经验规律是：一个程序 90%的执行时间花费在仅10%的代码中。

#### Amdahl定律

可以计算出通过改进计算机某一部分而能获得的性能增益。

$$
加速比=\frac{整个任务在未采用该升级时的执行时间}{整个任务在采用该升级时的执行时间}
$$

#### 处理器性能公式

程序的 CPU 时间

$$
CPU 时间=程序的 CPU 时钟周期数 \times时钟周期时间
$$

计算所执行的指令数：指令路径长度或指令数 (IC)

如果我们知道时钟周期数和指令数，就可以计算每条指令时钟周期数 (CPI)的平均值

$$
CPI=\frac{程序的CPU时钟周期数}{指令数}
$$

- 时钟周期时间：硬件技术与组成
- CPI：组成与指令集体系结构
- 指令数：指令集体系结构和编译器技术

## 存储器层次结构设计

4核的i7处理器总峰值带宽为 409.6 GB/s；实现缓存的多端口和流水线；利用多级缓存，为每个核心使用独立的第一级缓存，有时也使用独立的第二级缓存；在第一级使用独立的指令与数据缓存。与其形成鲜明对比的是DRAM 主存储器的峰值带宽只有它的 6% (25 GB/s ).

**平均访问时间**是由缓存访问时间、缺失率和缺失代价决定的；同时，**功耗**也成为设计人员的主要考虑事项

当取一个数据时，会同时将**一个块**移动到高层的存储器中

**如何写入缓存数据：**

1. 直接写入，在更新缓存中的数据时候，同时写入主存储器
2. 回写策略，仅在要替换这个块时，再将它复制回存储器

使用**缺失率**来衡量不同缓存组织形式的优劣，一种"3c"模式将所有这些缺失情景分为以下三个简单的类别：

- 强制：对一个数据块的第一次访问，这个块不可能在缓存中，所以必须将这个块调人缓存中。即使拥有无限大的缓存，也会发生强制缺失。
- 容量：如果缓存不能包含程序运行期间所需要的全部块，就会因为有些块被放弃，之后再被调入，从而导致容量缺失
- 冲突：如果块放置策略不是全相联的，如果多个块映射到一个块的组中，对不同块的访问混杂在一起，一个块可能会被放弃，之后再被调入，从而发生冲突缺失
