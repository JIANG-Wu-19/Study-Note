# 数字图像处理

## 基础

图像处理的三个层次：

- 图像处理：图像->图像
- 图像分析：图像->描述
- 图像识别：图像->语义

处理的是数字信号，在数学上是离散的

何凯明 去雾算法

期刊：CVPR ICCV ECCV



### 人眼视觉感知

人眼辨别亮度差别的能力，与环境亮度和本身亮度有关（马赫带效应）

人眼和照相机

- 眼帘=镜头盖
- 瞳孔=光圈
- 晶状体=透镜
- 视网膜=底片
- 视觉神经细胞（视感细胞，视锥细胞） vs 感光药膜

视杆细胞：只对光的振幅感兴趣，而对波长不敏感

视锥细胞：对波长敏感，分布在中央凹的位置，色盲的视锥细胞有不完善的地方

小孔成像



#### 韦伯定律

$\Delta I_c$：照射分量

$I_c$：照射强度

> 较小的$\frac{\Delta I_c}{I_c}$值意味着可辩别亮度小百分比变化。这表示“较好”的亮度辨别能力。相反，较大的$\frac{\Delta I_c}{I_c}$意味着人眼检测变化时要求较大百分比的亮度变化。这表示“较差”的亮度辨别能力。

照射强度和反射强度

人眼辨别亮度的能力与环境亮度和本身亮度有关



### 图像采样与量化

连续 <font color=red>`（空间坐标连续+幅值连续）`</font>->数字形式

采样：空间坐标的离散化。决定图像的 <font color=red>空间分辨率 </font>

量化：图形幅值的数字化，决定图像的 <font color =red>`幅度（灰度级）分辨率 `</font>

**动态范围 (Dynamic Range):**
动态范围是指在图像或场景中可分辨的最暗部分和最亮部分之间的亮度比例或范围。高动态范围（HDR）意味着图像包含了从非常暗到非常亮的广泛亮度级别，能够更好地捕捉现实世界中的亮度变化。低动态范围的图像则可能丢失细节，尤其是在极亮或极暗的区域。

**对比度 (Contrast):**
对比度是指图像中明暗区域之间的差异度。高对比度的图像具有更明显的亮暗区分，使图像看起来更加鲜明、有层次感。低对比度图像的亮暗区别不太明显，看起来较为平坦和模糊。对比度强调的是亮度差异的强度。

**饱和度 (Saturation):**
饱和度是指颜色的强度或纯度。高饱和度的图像颜色看起来更加鲜艳和明亮，而低饱和度的图像颜色则较为柔和、接近灰色。彩色图像的饱和度降低到最低点就变成了黑白图像。饱和度影响的是颜色的鲜艳程度，而不是亮度。





#### 空间与灰度分辨率

**空间分辨率：**离开空间单位谈图像大小没意义，所以我们尝试使用dpi描述图像分辨率

dpi：单位面积上像素点的个数



**灰度分辨率**：量化灰度的比特数，比如256个灰度级就是8bit



图像内插：调整图像大小、旋转、几何校正

- 下采样/收缩：行列删除
- 上采样/放大：创建新的像素位置



#### 图像放大

创建新的像素位置，对新位置上的像素赋值

##### 最近邻插值

- ​	把原图中最邻近的灰度赋给每个新像素
- 优点：简单易行 速度快
- 缺点：容易产生马赛克效应



##### 单线性插值

已知中P1点和P2点，坐标分别为(x1, y1)、(x2, y2)，要计算 [x1, x2] 区间内某一位置 x 在直线上的y值

<img src="assets/v2-126fe08d8c3fa51caaea6416f692d516_720w.webp" alt="img" style="zoom:50%;" />

简单整理公式为以下格式，可以理解为分子距离x1和x2的距离

<img src="assets/v2-901535930273893463a1f115bc4b1564_720w.webp" alt="img" style="zoom:67%;" />



##### 双线性插值

用四个邻近位置上的灰度值估计给定位置的灰度值

<img src="assets/image-20230924181508522.png" alt="image-20230924181508522" style="zoom:67%;" />



##### 双三次插值

和双线性插值的映射方法差不多，需要16个点完成



### 像素间的一些基本关系

像素之间的关系：邻接、连接、连通、通路

像素集合之间的关系：邻接、连接、连通



#### 像素间的距离

欧式距离$$D_e$$：范数为2的距离。设像素p和q的坐标分别为$(x,y)$和$(s,t)$，他们之间的欧氏距离定义为：
$$
D_{\mathrm{E}}(p, q)=\sqrt{(x-s)^2+(y-t)^2}
$$
城区距离$D_4$ ：也叫曼哈顿距离，是范数为1的距离
$$
D_4(p, q)=|x-s|+|y-t|
$$
棋盘格距离$D_8$：也叫切比雪夫距离
$$
D_8(p, q)=\max \{|x-s|,|y-t|\}
$$


![image-20230924185205760](assets/image-20230924185205760.png)





## 空间域图像增强

**灰度变换与空间滤波**

- 图像增强：对图像数据处理

  - 图像增强不改变图像内容，只是改变灰度分布

- 空间域图像增强：图像平面本身，直接对**像素**操作

  - $g(x,y)=T[f(x,y)]$

  - T变换的处理对象是某个邻域

    ![image-20231008155203895](assets/image-20231008155203895.png)

- 变换域图像增强：通过数学变换将图像转换到变换域后进行处理，再转换回空间域



### 灰度变换函数

**图像反转变换**

$s=(l-1)-r$，s为新图像的灰度值，r为当前图像的灰度值

灰度图像：黑白颠倒  彩色图像：补色

<img src="assets/image-20231008155522346.png" alt="image-20231008155522346" style="zoom:67%;" />

<center> 各种灰度变换函数 </center>



**对数变换**

$s=c\log(1+r)$，c为常数，r非负

- 增强低灰度，抑制高灰度
- 应用：压缩图像的动态范围

暗区压缩，暗部变少

亮区压缩，亮部增加



**反对数变换**

$s=c/\log(1+r)$，c为常数，r为非负



**伽马（幂次）变化**

$s=cr^\gamma$，c,r为非负

- $\gamma<1$: 扩展暗像素值，压缩亮像素值
- $\gamma>1$: 压缩暗像素值，扩展亮像素值

<img src="assets/image-20231008160327964.png" alt="image-20231008160327964" style="zoom:67%;" />



**伽马校正**

某些设备 (ex: CRT) 的**电压-亮度**曲线近似为幂函数

经过伽马校正后的图像作为输入，更加接近真实显示值



**分段线性变换**

将灰度级划分为不同范围，每个范围采用不同的线性变换

主要形式：

- 对比度拉伸：提高图像灰度级的动态范围

  ![image-20231008161233522](assets/image-20231008161233522.png)

- 灰度级分层（灰度切割）: 提高图像中特点灰度范围的亮度

- 比特平面分层（位图切割）：分析图像每个比特的相对重要性

  - 信息多存在于高层比特上



### 直方图处理

定义：描述每个灰度值的像素个数

**基于直方图的图像增强技术：**

- 直方图均衡
- 直方图规定化



#### 直方图均衡

定义：将原图像的直方图通过**灰度变换函数**$s=T(r)$对灰度修正，使得灰度概率密度函数(PDF)为均匀分布

目的：增加像素灰度值的动态范围，从而达到增强图像整体对比度的效果；把任意的直方图均衡化均匀的直方图

变换函数要求：

- 均匀分布且连续可微
- 单调递增

公式结论：

- 变换的连续形式：
  $$
  s=T(r)=(L-1)\int^r_0p_r(w)dw
  $$

- 公式的离散形式：

$$
s_k=T(r_k)=(L-1)\sum^k_{j=0}p_r(r_j)=\frac{L-1}{MN}\sum^k_{j=0}n_j \quad k=0,1,2,...,K-1
$$



小结：直方图均衡化

- **非线性拉伸**
- 增强对比度，不改变图像内容
- 有些灰度被拉断了，造成细节损失



#### 直方图规定化

定义：修改一幅图片直方图，使其与另一幅图像的直方图匹配或者具有一种预先规定的函数形状

目标：突出感兴趣的部分
$$
z=\boldsymbol{G}^{-1}(s)=\boldsymbol{G}^{-1}(T(r))
$$


### 空间滤波基础

空间域模板进行图像处理。模板本身被称为空域滤波器
$$
g(x, y)=\sum_{s=-a}^a \sum_{t=-b}^b w(s, t) f(x+s, y+t)
$$

#### 空间滤波与卷积

相关操作：
$$
w(x, y)\star f(x, y)=\sum_{s=-a}^a \sum_{t=-b}^b w(s, t) f(x+s, y+t)
$$
卷积操作：
$$
w(x, y) \star f(x, y)=\sum_{s=-a}^a \sum_{t=-b}^b w(s, t) f({x-s, y-t})
$$
向量表示：
$$
R=w_1 z_1+w_2 z_2+\ldots+w_{m n} z_{m n}=\sum_{k=1}^{m n} w_k z_k=\boldsymbol{w}^T \boldsymbol{Z}
$$


### 平滑空间滤波器

作用：

- 模糊处理：去除图像中一些不重要的细节
- 减少噪声



平滑空间滤波器分类：

- 平滑线性滤波器：均值滤波器
- 统计排序滤波器（非线性）：最大值滤波器，中值滤波器，最小值滤波器





加权均值滤波：
$$
g(x, y)=\frac{\sum_{s=-a t=-b}^a \sum^b w(s, t) f(x+s, y+t)}{\sum_{s=-a t=-b}^a \sum^b w(s, t)}
$$


### 锐化（高通）滤波器

用途：突出细节



一阶微分产生较粗的边缘，二阶微分产生双边缘

二级微分比一阶微分对细节有更为强烈的响应，易于实现



非锐化掩膜：

1. 模糊原图像
2. 从原图像中减去模糊后的图像
3. 模板与原图相加



Sobel算子：

1. 定义算子

<img src="assets/image-20230609195715352.png" alt="image-20230609195715352" style="zoom: 50%;" />

2. 与图像卷积以达到求导：

$$
\frac{\delta f}{\delta x}S_x \otimes f \qquad \frac{\delta f}{\delta y}S_y \otimes f
$$



3. 计算梯度：

<img src="assets/image-20230609202828522.png" alt="image-20230609202828522" style="zoom:60%;" />

4. 边缘检测：根据梯度强度和方向来判断像素是否为边缘点。通常，可以根据梯度强度设置一个阈值，将梯度强度大于阈值的像素标记为边缘点，否则标记为非边缘点。

对噪声敏感：

<img src="assets/image-20230609203248100.png" alt="image-20230609203248100" style="zoom: 40%;" />





为什么均值化会拉断？自适应均衡化



## 频率域滤波

问题的提出：偏微分方程(PDE)

法国数学家D`Almbert
$$
u(x, t)=f(x+c t)+g(x-c t)
$$
瑞士数学家 D.Bernoulli 
$$
u(x, t)=\sum_{n=0}^{\infty}\left[a_n \cos n x+b_n \sin n x\right]
$$



### 信号正交

定义在$(t_1,t_2)$区间的$\varphi_1(t)$和$\varphi_2(t)$满足
$$
\int_{t_1}^{t_2}\phi_{1}( t) \phi{2}( t)  d_t= 0 \quad  (两函数的内积为0)
$$
则称$\varphi_{1}(t)$和$\varphi_2(t)$ 在区间($t_1,t_2$)内正交。



**正交函数集：**

函数集内任意两个不同的函数都满足正交，则称为**正交函数集**



**信号的正交分解：**

设有$n$个函数$\varphi_1(t)$,$\varphi_2(t),\cdots,\quad\varphi_n(t)$在区间$(t_1,t_2)$构成一个正交函数空间将任一函数$f(x)$用这$n$个正交函数的线性组合来近似, 可表示为

$$
f(t)\approx C_1\varphi_1+C_2\varphi_2+\cdots+C_n\varphi_n
$$

如何选择各系数$C_j$使$f(t)$与近似函数之间的误差在区间$(t_1,\quad t_2)$内为最小。通常使误差的方差均值(称为均方误差)最小。均方误差为

$$
{\overline{\varepsilon^2}=\frac1{t_2-t_1}\int_{t_1}^{t_2}[f(t)-\sum_{j=1}^nC_j\varphi_j(t)]^2\operatorname{d}t}
$$

为使上式最小（系数Cj变化时，即Cj为变量），有**Leibnitz准则（求偏导等于0处取最小值）**，有：
$$
\frac{\partial\overline{\varepsilon^2}}{\partial C_i}=\frac{1}{t_2-t_1}\frac\partial{\partial C_i}\int_{t_1}^{t_2}\left[f(t)-\sum_{j=1}^nC_j\varphi_j(t)\right]^2\operatorname{d}t=0
$$

展开被积函数，由于**正交性** ，以及前面的系数，只有两项不为0：
$$
\frac{\partial}{\partial C_i} \int_{t_1}^{t_2}\left[-2 C_i f(t) \varphi_i(t)+C_i^2 \varphi_i^2(t)\right] \mathrm{d} t=0
$$

$$
即：-2 \int_{t_1}^{t_2} f(t) \varphi_i(t) \mathrm{d} t+2 C_i \int_{t_1}^{t_2} \varphi_i^2(t) \mathrm{d} t=0
$$

$$
C_i=\frac{\int_{t_1}^{t_2} f(t) \varphi_i(t) \mathrm{d} t}{ \int_{t_1}^{t_2} \varphi_i^2(t) \mathrm{d} t}=\frac{1}{K_i} \int_{t_1}^{t_2} f(t) \varphi_i(t) \mathrm{d} t
$$



### 傅里叶分析

傅里叶分析可分为傅里叶级数（Fourier Serie）和傅里叶变换(Fourier Transformation)

傅里叶分析的作用：

在时域看似不可能做到的数学操作，在频域相反很容易。这就是需要傅里叶变换的地方。尤其是从某条曲线中去除一些特定的频率成分，也就是称为滤波



不同频率的正弦波我们成为频率分量，如果第一个频率最低的频率分量为 1 ，我们就有了构造频域的最基本单位

那么频域的“0”是什么呢？cos（0t）就是一个周期无限长的正弦波，也就是一条直线！所以在频域，0频率也被称为直流分量，在傅里叶级数的叠加中，它仅仅影响全部波形相对于数轴整体向上或是向下而不改变波的形状。

![img](assets/841476e8e15e1d08114b65c50b741930_720w.webp)

一个矩形波在频域里面的样子：

![img](assets/e2e3c0af3bdbcba721c5415a4c65da9e_720w.webp)

清楚一点：

![img](assets/40cf849e55ed95732a60b52d4019d609_720w.webp)

#### 傅里叶级数





#### 傅里叶变换（Fourier Transformation）

傅里叶级数，在时域是一个周期且连续的函数，而在频域是一个非周期离散的函数。这句话比较绕嘴，实在看着费事可以干脆回忆第一章的图片。

而傅里叶变换，则是将一个时域非周期的连续信号，转换为一个在频域非周期的连续信号。

![img](assets/419cd0b2e965aca25d5f8a5a6362d728_720w.webp)

原来离散谱的叠加，变成了连续谱的累积。所以在计算上也从求和符号变成了积分符号。

**连续单变量函数的傅里叶变换**
$$
\begin{aligned}
& f(t)=\mathfrak{F}^{-1}\{F(u)\}=\int_{-\infty}^{\infty} F(u) \mathrm{e}^{j 2 \pi u t} \mathrm{~d} u & 傅里叶逆变换\\
& F(u)=\mathfrak{F}\{f(t)\}=\int_{-\infty}^{\infty} f(t) \mathrm{e}^{-j 2 \pi u t} \mathrm{~d} t  & 傅里叶变换
\end{aligned}
$$

时域是复频域投影到频域中的各成分的累积



> 举个例子

对如下函数做傅里叶变换：

<img src="assets/v2-effaea4394f2393808da66a9f4ebc41a_720w-16983931831222.webp" alt="img" style="zoom: 50%;" />

由图可以知：

$$f(x)= \begin{cases}A & x>-W / 2 \& x<W / 2 \\ 0 & x<-W / 2 \mid x>W / 2\end{cases}$$

代入傅里叶变换公式：
$$
\begin{aligned}
F(\mu) & =\int_{-\infty}^{\infty} f(t) e^{-j 2 \pi \mu t} d t=\int_{-W / 2}^{W / 2} A e^{-j 2 \pi \mu t} d t \\
& =\frac{-A}{j 2 \pi \mu}\left[e^{-j 2 \pi \mu t}\right]_{-w / 2}^{W / 2}=\frac{-A}{j 2 \pi \mu}\left[e^{-j \pi \mu W}-e^{j \pi \mu W}\right] \\
& =\frac{A}{j 2 \pi \mu}\left[e^{j \pi \mu W}-e^{-j \pi \mu W}\right] \\
& =A W \frac{\sin (\pi \mu W)}{(\pi \mu W)}
\end{aligned}
$$
最终得到 sinc 函数的曲线：

![img](assets/v2-0cb0f67debda9dd1104a4b026a66bf3f_720w.webp)

通常，傅里叶变换包含了复数项，且为了显示目的，通常处理该变换的幅值（一个实量），该幅值称为傅里叶谱或频谱：
$$
|F(\mu)|=AW\left|\frac{\sin(\pi\mu W)}{(\pi\mu W)}\right|
$$
![img](assets/v2-ed442e67285542c8a2a3bdb9897873d6_720w.webp)





### 取样与采样函数的傅里叶变换

> 狄拉克函数：幅度无限，持续时间为0，具有单位面积和尖峰信号

#### 冲击函数

连续变量t在t=0处的单位冲击被定义为：
$$
\begin{array}{ll}
\delta(t)=  \begin{cases}\infty, & t=0 \\
0, & t \neq 0\end{cases} \\
\text { s.t. } \quad \int_{-\infty}^{\infty} \delta(t) \mathrm{d} t=1
\end{array}
$$
其傅里叶变换为：
$$
F(\mu)=\int_{-\infty}^\infty\delta(t)\mathrm{e}^{-\mathrm{j}2\pi\mu t}\mathrm{d}t=\int_{-\infty}^\infty\mathrm{e}^{-\mathrm{j}2\pi\mu t}\delta(t)\mathrm{d}t=\mathrm{e}^{-\mathrm{j}2\pi\mu0}=\mathrm{e}^0=1
$$
**这个变换表示，位于原点的单位冲激函数在频率域是一个常数**。



离散变量在$x=x_0$处的冲击函数：
$$
\sum_{x=-\infty}^\infty f(x)\delta(x-x_0)\mathrm{d}x=f(x_0)
$$
其傅里叶变换为：
$$
F(\mu)=\int_{-\infty}^\infty\delta\left(t-t_0\right)\mathrm{e}^{-\mathrm{j}2\pi\mu t}\mathrm{d}t=\int_{-\infty}^\infty\mathrm{e}^{-\mathrm{j}2\pi\mu t}\delta\left(t-t_0\right)\mathrm{d}t=\mathrm{e}^{-\mathrm{j}2\pi\mu t_0}=\cos(2\pi\mu t_0)-\mathrm{j}\sin(2\pi\mu t_0)
$$
**它表示了以复平面原点为中心的单位圆**



**冲击串**的傅里叶级数：$$s_{\Delta T}(t)=\sum_{n=-\infty}^{\infty}\delta(\boldsymbol{x}-n\Delta T)$$
$$
\begin{aligned}
&s_{\Delta T}(t) =\sum_{n=-\infty}^{\infty}c_{n}\mathrm{e}^{\mathrm{j}\frac{2\pi n}{\Delta T}t}  \\
&{\text{其中 }c_{n}} =\frac{1}{\Delta T}\int_{-\Delta T/2}^{\Delta T/2}s_{\Delta T}(t)\mathrm{e}^{-j\frac{2\pi n}{\Delta T}t}\mathrm{d}t 
\end{aligned}
$$


**周期为 $\Delta T$ 的冲激串的傅里叶变换还是冲激串，其周期是 $1/\Delta T$ , $s_{\Delta T}(t)$ 和 $S(\mu)$ 之间呈现周期反比关系。**



#### 卷积

时域内两个函数卷积 = 频域内两个函数相乘

时域内两个函数相乘 = 频域内两个函数卷积



#### 取样函数的傅里叶变换

取样后函数：$$\tilde{f}(t)=f(t)s_{\Delta T}(t)=\sum_{n=-\infty}^{\infty}f(t)\delta(t-n\Delta T)$$

傅里叶变换：$$\tilde{F}(u)=\mathfrak{F}\{\tilde{f}(t)\}=\mathfrak{F}\{f(t)s_{\Delta T}(t)\}=F(u)\star\boxed{S(u)}$$

取样函数和傅里叶变换后函数均为周期函数，取样函数的周期为${\Delta T}$，傅里叶变换后周期为$\frac{1}{\Delta T}$



**带限函数：**对于函数$f(t)$，如果傅里叶变换后函数是以原点为中心，具有有限区域，区域之外的频率值为0，则称函数$f(t)$为带限函数

带限函数恢复条件：$\frac{1}{\Delta T}\ge 2u_{\max}$



问题：如何根据$\tilde F(u)$恢复$f(t)$

1. 将$\tilde F(u)$恢复成带限函数，必须要带限函数才能恢复
2. 利用傅里叶反变换复原



如果用低于最高频率的两倍取样率对带限函数进行取样，会产生混淆：

![image-20231028105934339](assets/image-20231028105934339.png)

如最后一个图，频率受到邻近周期的破坏



### 单变量的离散傅里叶变换（DFT）

取样是为了把时域的连续函数变为计算机中可以处理的离散点

一个在时域上的离散函数，傅里叶变换后它的频域上的变换可以是连续的，并且是周期的。

时域上连续函数取样后的函数是变成离散的计算机可以处理的数据了，但是傅里叶变换后的频域上还是连续的啊。怎么让计算机连频域上的数据都可以处理呢？对！老方法再用一次，对频域信号进行采样呗~

取样函数：$\tilde{f}(t)=f(t)s_{\Delta T}(t)=\sum_{n=-\infty}^{\infty}f(t)\delta(t-n\Delta T)$

傅里叶变换：
$$
\begin{aligned}
\tilde{F}(u)& =\mathfrak{F}\{\tilde{f}(t)\}=\int_{-\infty}^{\infty}\sum_{n=-\infty}^{\infty}f(t)\delta(t-n\Delta T)\mathrm{e}^{-j2\pi ut}\mathrm{d}t  \\
&=\sum_{n=-\infty}^{\infty}\int_{-\infty}^{\infty}f(t)\delta(t-n\Delta T)\mathrm{e}^{-j2\pi ut}\mathrm{d}t=\sum_{n=-\infty}^{\infty}f_{n}\mathrm{e}^{-j2\pi u\Delta T} \\
&f_n=\int_{-\infty}^{\infty}f(t)\delta(t-n\Delta T)=f(n\Delta T)\quad\text{离散}
\end{aligned}
$$


时域离散函数的傅里叶变换是周期为$\frac 1{ \Delta T}$的无限周期连续函数

假设我们想要在周期 $\mu=0$ 到 $\mu=1/\Delta T$ 之间得到的 $\tilde{F}(\mu)$ 的 $M$ 个等间距样本，可以通过加如下频率处取样得到：

$$
\mu=\frac m{M\Delta T},\quad m=0,1,2,\cdots,M-1
$$
>  注：
>  这里已经开始对频率域的 $\tilde{F}(\mu)$ 进行一个周期采样啦。

把 $\mu$ 代入上式，我们用 $F_m$ 表示得到的结果：

$$
F_m=\sum_{n=0}^{M-1}f_n\mathrm{e}^{-\mathrm{j}2\pi mn/M},\quad m=0,1,2,\cdots,M-1
$$
这已经是我们定义的DFT啦！



$u,v$表示频率$x,y$ 表示坐标
$$
离散傅里叶变换：& F_{m}=\sum_{n=0}^{M-1}f_{n}\mathrm{e}^{-j2\pi mn/M}\:,& m=0,1,2,\cdots\:,M-1\\

离散傅里叶反变换：& f_{n}=\frac{1}{M}\sum_{n=0}^{M-1}F_{m}\mathrm{e}^{j2\pi mn/M}\:,& n=0,1,2,\cdots\:,M-1
$$

$$
离散傅里叶变换： & F(u)=\sum^{M-1}_{x=0}f(x)e^{−j2πux/M} &u=0,1,2,\cdots,M-1 \\
离散傅里叶反变换:& f(x)=\frac{1}{M}\sum_{n=0}^{M−1}F(u)e^{j2\pi ux/M}&  x=0,1,2,⋯,M−1
$$


### 双变量函数的傅里叶变换

双连续变量的冲激函数及其取样特性：
$$
\left.\delta(t,z)=\left\{\begin{array}{ll}\infty,&t=z=0\\0,&x\neq0\end{array}\right.\right.\\\text{s.t.}\quad\int_{-\infty}^{\infty}\int_{-\infty}^{\infty}\delta(t,z)\mathrm{d}t\mathrm{d}z=1
$$
取样特性：
$$
\begin{aligned}\int_{-\infty}^\infty\int_{-\infty}^\infty f(t,z)\delta(t,z)\mathrm{d}t\mathrm{d}z&=f(0,0)\\\\\int_{-\infty}^\infty\int_{-\infty}^\infty f(t,z)\delta(t-t_0,z-z_0)\mathrm{d}t\mathrm{d}z&=f(t_0,z_0)\end{aligned}
$$
2D DFT 及 IDFT
$$
\begin{aligned}F(u,v)&=\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}f(x,y)\mathrm{e}^{-j2\pi(ux/M+vy/N)}\\\\f(x,y)&=\frac{1}{{MN}}\sum_{u=0}^{M-1}\sum_{v=0}^{N-1}F(u,v)\mathrm{e}^{j2\pi(ux/M+vy/N)}\end{aligned}
$$




### 二维离散傅里叶变换的一些性质

**空间与频率间隔的关系：**
$$
\begin{aligned}\Delta u&=\frac{1}{M\Delta T}\\\\\Delta v&=\frac{1}{N\Delta Z}\end{aligned}
$$
**平移：**
$$
f(x,y)\mathrm{e}^{j2\pi(u_0x/M+v_0y/N)} \Leftrightarrow F(u-u_0,v-v_0)\\ f(x-x_0,y-y_0)\Leftrightarrow F(u,v)\mathrm{e}^{-j2\pi(u_0x/M+v_0y/N)}
$$

平移对频谱无影响，但影响相位谱；相位谱携带图像中物体的定位信息

旋转同时影响频谱和相位谱



### 频率域滤波基础

图像的频率域表示：$F(u,v)=\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}f(x,y)\mathrm{e}^{-j2\pi(ux/M+vy/N)}$

- 图像的频率：表征图像中灰度变化剧烈程度
- $u=v=0$ 变化最慢，直流
- 低频：图像中变换缓慢的灰度分量
- 高频：图像中灰度急剧变化的分量
- 频率域滤波：通常修改图像的傅里叶频谱；



直流分量：图像的平均灰度
$$
F(0,0)=\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}f(x,y)=MN\bar{f}(x,y)
$$

**二维卷积定理：**

二维循环卷积
$$
f(x,y)\star h(x,y)=\sum_{m=0}^{M-1}\sum_{n=0}^{N-1}f(m,n)h(x-m,y-n)
$$
二维卷积定理
$$
\begin{aligned}&f(x,y)\star h(x,y)=F(u,v)H(u,v)\\[2ex]&f(x,y)h(x,y)=\frac{1}{2\pi}F(u,v)\star H(u,v)\end{aligned}
$$
频率域滤波通常需要填充，主要是为了避免在傅里叶变换和逆傅里叶变换之间出现的问题，将离散的变成连续的；



- 对滤波器做IDFT，得到空间滤波器，在空间域填充，DFT返回频率域
  - 产生震铃效果
- 先对图像填充0，然后在频域创建尺寸与填充过图像一样大小的滤波器
  - 导致交叠错误



步骤：

- 输入： M× N 图像$f(x,y)$ 
- 零填充，$M*N ->(2M)*(2N)$
- 乘以(-1)$^{x+y}$进行频谱中心化
- 计算出它的傅立叶变换F(u,\nu)
- 选择一个变换函数$H(u,v)$,计算$H(u,v)F(u,v)$
- 计算出它的反傅立叶变换
- 用$(-1)^{x+y}$乘以上面结果的实部
- 提取左上角原始图像大小的区域得目标图像



### 频域图像平滑

基本思想：利用频域低通滤波器平滑图像

- 理想低通滤波器
- 巴特沃斯低通滤波器
- 高斯低通滤波器



#### 理想低通滤波器

$$
H(u,v)=\begin{cases}1&D(u,\nu)\leq D_0\\0&D(u,\nu)>D_0\end{cases}
$$
$D_0$为截至频率，是一个正常数

$D(u,v)$为频率中$(u,v)$点到频率矩阵中心的距离
$$
{D(u,v)=\sqrt{(u-P/2)^2+(v-Q/2)^2}}
$$
![image-20231107090010009](assets/image-20231107090010009.png)

截至频率的设计：

- 首先计算总功率
  $$
  P_T=\sum_{u=0}^{M-1}\sum_{\nu=0}^{N-1}P(u,\nu)
  $$

- 如果将变换做中心平移，以频域中心为原点，$r$为半径就包含了$\beta\%$的能量
  $$
  \beta=100\left[\sum_u\sum_vP(u,v)/P_T\right]
  $$

- 图像中大多细节都存储在高频$(0.8\%-13\%)$之中
- 理想低通滤波器会产生震铃现象



#### 高斯低通滤波器(Gaussian Low-Pass Filtering, GLPF)

$$
\begin{aligned}H(u,v)&=e^{-D^2(u,v)/2D_0^2}\\\\D(u,v)&=\sqrt{(u-M)^2+(v-N)^2}\end{aligned}
$$

![image-20231107091024385](assets/image-20231107091024385.png)

- 没有振铃
- $D_0$越大越好



#### 巴特沃斯低通滤波器

$$
\begin{aligned}H(u,\nu)&=\frac{1}{1+\left[D(u,\nu)/D_0\right]^{2n}}\\\\D(u,v)&=\sqrt{(u-M)^2+(v-N)^2}\end{aligned}
$$

![image-20231107091806318](assets/image-20231107091806318.png)

- 不存在一个不连续点作为截止频率的明显区分
- 把$H(u,v)$开始小于其最大值的一定比例的点当作其截至频率点
- $D(u,v)=D_0$时，$H(u,v)=0.5$

![image-20231107093745459](assets/image-20231107093745459.png)

- 一阶：没有振铃
- 二阶：不明显
- n越大，振铃越明显

### 频域图像锐化

**基本思想：衰减低频成分而不干扰高频信息**

![image-20231107094047568](assets/image-20231107094047568.png)

**频率域拉普拉斯算子**

空域二维拉普拉斯算子：$\nabla^2f(t,z)=\frac{\partial^2f}{\partial t^2}+\frac{\partial^2f}{\partial z^2}$

频率二维拉普拉斯算子：$H(u,v)=-4\pi^{2}(u^{2}+v^{2})$

中心化：$H(u,v)=-4\pi^2\left[(u-P/2)^2+(v-Q/2)^2\right]=-4\pi^2D^2(u,v)$



### 选择性滤波

带阻滤波器和带通滤波器：

- 理想带阻滤波器、
  $$
  \begin{aligned}
  &\left.H(u,v)=\left\{\begin{array}{ll}{0,}&{{D_{0}-\frac{W}{2}\leq D(u,v)\leq D_{0}+\frac{W}{2}}}\\{1,}&{{\mathrm{otherwise}}}\end{array}\right.\right.
  \end{aligned}
  $$

- 巴特沃斯带阻滤波器
  $$
  H(u,v)=\frac{1}{1+\left[\frac{DW}{D^{2}-D_{0}^{2}}\right]^{2n}}
  $$

- 高斯带阻滤波器
  $$
  H(u,v)=1-\mathrm{e}^{-[{\frac{D^{2}-D_{0}^{2}}{DW}}]^{2}}
  $$
  



![image-20231107092351740](assets/image-20231107092351740.png)

总结：

![image-20231107092051561](assets/image-20231107092051561.png)



## 复原和重建

平滑噪声可以降低噪声，但也会模糊图像







## 小波变换

多分辨率理论基础





## 图像压缩

### 基础知识



### 一些基本的压缩方法

#### 霍夫曼编码

使用不同的码长，



## 形态学处理





## 图像分割
